/*! lxapp 2016-03-30 */
!function(a){function b(a){"undefined"==typeof a&&(a=100),window.scrollTo(0,m.scrollTop()+1),setTimeout(function(){window.scrollTo(0,m.scrollTop()-1)},a)}function c(a){var b="iscrollScript",c=$("#"+b);c.length>0?a():$("<script>").attr({id:b,src:"../js/libs/iscroll.js"}).on("load",a).appendTo("body")}function d(b,d,e,f,g,h){var i,j,k=new Date,m=$(b).html(),n="function"==typeof f?f(d):d,p="";if(h=h||$(".wrapper").last(),null==n)return p;if($.isEmptyObject(n)||($datum[b.replace(/^#|\-tmpl/g,"")]=n),!m)return j="template "+b+" is missing or empty!",console.error(j),"<p>"+j+"</p>";var q=[];n.content&&($.each(n.content,function(a,b){"txt"==b.type?$.trim(b.value)&&q.push(b):q.push(b)}),n.content=q);try{if(p=ejs.compile(m)(n,{compileDebug:!0}),g)return p;i=$(p),e?(l=[],h.html(i)):h.append(i),h.trigger("partDone",[b,n]),l.push(i[0])}catch(r){if(a.$debug===!0)throw r.message="error while compiling "+b+":"+r.message,r}"sx-topics"!=h.attr("id")||window.$wap||c(function(){new IScroll($(".topics-list")[0],{scrollX:!0,scrollY:!1,preventDefault:!1})});var s=new Date,t=s-k;return o+=t,a.$debug&&console.log("//Profiling: Render "+b+" use "+(s-k)+"ms"),this}function e(a){var b={};for(var c in a)b[c]="object"==typeof a[c]?e(a[c]):a[c];return b}function f(b,c,d){var f,g="#"+b+"-tmpl",h=$(g).html(),i="function"==typeof d?d(c):c;if(null==i)return this;var j=e(c);if(i.originData=j,!h)return console.error("template "+g+" is missing or empty!"),this;$.isEmptyObject(i)||($datum.mod[g.replace(/^#|\-tmpl/g,"")]=i);try{f=ejs.compile(h)(i,{ompileDebug:!0})}catch(k){if(a.$debug===!0)throw k.message="error while compiling "+g+":"+k.message,k}return f}function g(a,b){return function(c,e){return d.call(k,a,c,e,null,!1,b?b():null)}}function h(a,b,c,d){var e,f=c.replace(/<p[\s\S]*?>([\s\S]*?)<\/p>/g,"$1").replace(/\}<br\/>/,"}"),g={},h=b-20;if(f&&f.length>=2)try{e=JSON.parse(f),g=$.isArray(e)?{items:e}:e}catch(i){console.error(i.toString())}if("gallery"==a){var j;try{j=JSON.parse(d.transUrls)}catch(i){}j=j||[],$.each(g.items,function(a,b){b.transUrl=j[a],b.items=b.imgurl.split("|"),b.data=JSON.stringify(b);var c=1,d=0;imgWidth=b.imgWidth=Math.floor((h-d)/c),n=b.items.length,b.imgHeight=Math.floor(3*imgWidth/4),b.itemPerPage=c,b.scrollerWidth=(imgWidth+5)*n-5,b.originalPhotos=b.items,b.items=b.items.map(function(a){return $utils.dmfd(a,imgWidth,b.imgHeight,!0)}),b.total=b.items.length})}else"video"==a&&(g.w=h,g.h=(h/1.777).toFixed(0),g.items.forEach(function(a){a.url=a.url,a.imgurl=$utils.dmfd(a.imgurl,g.w,g.h,!0)}));return g}function i(a){return'<p style="white-space: normal;"></p>'==a||'<p style="white-space: normal;"><br/></p>'==a}function j(){var a=navigator.userAgent,b=/android/i;return b.test(a)}var k={},l=[],m=$(window),o=($(document),0);$.noop=function(){},a.$pageHPadding=16,a.$isWeixin=navigator.userAgent.toLowerCase().indexOf("micromessenger")>0,a.$datum={mod:{}},a.hasVideo=!1,ejs.open="{%",ejs.close="%}",$&&$.fn&&!$.fn.tap&&($.fn.tap=$.fn.click),k.render=d,k.renderArticleTitle=function(b,c){a.$debug===!0&&console.log("$ContentRender.renderArticle("+JSON.stringify(b)+");");var e=($(".wrapper"),d.call(this,"#article-title-tmpl",b,c,function(a){var b={content:$.extend(!0,[],a.content)};return a.time&&(isNaN(a.time)||a.time>0)?b.time=$utils.formatDate(a.time):b.time="",a.title&&(b.title=$utils.unescape(a.title),document.title=b.title),a.source&&(b.source=a.source),b},"",$("#sx-article-tit")));return e},k.renderArticleHtml=function(a){if(a.content[0]){var b=a.content[0],c=b.css||"",d=b.value||"";$("#sx-style").html(c),$("#sx-article").html(d)}},k.afterClickRss=function(a){0==a?($(".rss-toprt").addClass("subscribed"),console.log("success rss")):console.log("Failure rss")},k.makeNoPreprocessRender=g;var p={wiki:"mod",weibo:"mod",music:"mod",gallery:"mod",video:"mod","further-reading":"mod",blockquote:"mod","n-slash-total":"part","editor-comment":"part",headimg:"part"};k.renderGrayBar=function(b,c){return a.$debug===!0&&console.log("$ContentRender.renderGrayBar("+JSON.stringify(b)+");"),d.call(this,"#grayBar-tmpl",b,c,function(a){var b={tagData:$.extend(!0,[],a.transmit_data)};return b.transmit_num=a.transmit_num?a.transmit_num:"",b},"",$("#sx-graybar"))},k.renderArticle=function(b,c){a.$debug===!0&&console.log("$ContentRender.renderArticle("+JSON.stringify(b)+");");var e,g=$(".wrapper"),j=g.width()-2*$pageHPadding,k=[],l=d.call(this,"#article-tmpl",b,c,function(b){var c,d,g,l,m={content:$.extend(!0,[],b.content)};for(b.title&&(m.title=$utils.unescape(b.title),document.title=m.title),b.time&&(isNaN(b.time)||b.time>0)?m.time=$utils.formatDate(b.time):m.time="",b.wapurl&&(m.origin=b.wapurl),b.summary&&(m.summary=$utils.unescape(b.summary)),b.media&&!window.$wap&&(m.media=b.media),b.newtags&&b.newtags.length>0&&(m.tags=b.newtags.split("|")),b.source&&(m.source=b.source),b.editor_pic&&(m.editor_pic=$utils.dmfd(b.editor_pic,60,60)),b.editor_name&&(m.editor_name=b.editor_name),b.editor_desc&&(m.editor_desc=b.editor_desc),b.editor_comment&&(m.editor_comment=b.editor_comment),c=0;m.content&&c<m.content.length;++c)if(d=m.content[c],"img"==d.type){if(d.originalValue=d.value,g=d.value.match(/size=(\d+).*?(\d+)/),!g){console.error("DataError!image missing dimension:"+d.value);continue}j<g[1]?(l=j/g[1],d.width=j,d.height=Math.floor(l*g[2])):(d.width=g[1],d.height=g[2],d.descAlignCenter=!0),d.value=$utils.dmfd(d.value,d.width,d.height,!0)}else if("txt"==d.type)"img_title"==d.subtype?d.cssClass="caption":"head"==d.subtype?d.cssClass="head":(d.cssClass="normal",i(d.value)&&(d.value=null)),d.value&&d.value.match(/^\s*<p/)?d.noPTag=!0:d.noPTag=!1,d.value&&(d.value=$utils.unescape(d.value));else if("undefined"!=typeof p[d.type]){var n=h(d.type,j,d.value,d),o=p[d.type];"headimg"==d.type?(n.url&&(g=n.url.match(/size=(\d+).*?(\d+)/),j<g[1]?(l=j/g[1],d.width=j,d.height=Math.floor(l*g[2])):(d.width=g[1],d.height=g[2],d.descAlignCenter=!0),d.value=$utils.dmfd(d.value,d.width,d.height,!0)),e=f(o?o+"-"+d.type:d.type,n),m.content.splice(c,1),c--):"video"==d.type?(k.push(f(o?o+"-"+d.type:d.type,n)),a.hasVideo=!0):(1==n.showeditor&&(n._editorData={editor_pic:m.editor_pic,editor_name:m.editor_name,editor_desc:m.editor_desc}),d.value=f(o?o+"-"+d.type:d.type,n),d.type="html")}return m},"",$("#sx-article"));return k.length&&g.find("#video").append(k.join("")),e&&g.find(".article").prepend(e),l},k.renderRecommendArtices=function(b,c){window.detListData=b,a.$debug===!0&&console.log("$ContentRender.renderRecommendArtices("+JSON.stringify(b)+");");var e=$(".wrapper"),f=e.width()-2*$pageHPadding;console.log(b);var g="#recommend-articles-tmpl",h=$("#sx-recommond"),i=0,j=0;return d.call(this,g,b,c,function(a){return a.related&&a.related.length>0&&(a.related=a.related.splice(0,2),a.related.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.source=a.src,a.title=$utils.unescape(a.title),a.album_pic?(a.imgurl=a.album_pic.split("|")[0],a.width=i||Math.floor((f-15)/2),a.height=j||.6*a.width,a.img=$utils.dmfd(a.imgurl,a.width,a.height,!0)):a.img=a.imgurl})),a},"",h)},k.renderRecommendVideo=function(b,c){window.detListData=b,a.$debug===!0&&console.log("$ContentRender.renderRecommendVideo("+JSON.stringify(b)+");");var e=$(".wrapper"),f=e.width()-2*$pageHPadding;console.log(b);var g="#recommend-video-tmpl";return relatedWrap=$("#sx-videoRec"),videoPicW=110,videoPicH=62,d.call(this,g,b,c,function(a){return a.related_video&&a.related_video.length>0&&a.related_video.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.source=a.src,a.title=$utils.unescape(a.video_name),a.url=a.video_play_url,a.video_img?(a.imgurl=a.video_img,a.width=videoPicW||Math.floor((f-15)/2),a.height=videoPicH||.6*a.width,a.img=$utils.dmfd(a.imgurl,a.width,a.height,!0)):a.img=a.imgurl}),a},"",relatedWrap)},k.renderhotArtices=function(b,c){window.detListData=b,a.$debug===!0&&console.log("$ContentRender.renderhotArtices("+JSON.stringify(b)+");");var e=$(".wrapper");e.width()-2*$pageHPadding;return d.call(this,"#hot-articles-tmpl",b,c,function(a){return a.hotNewsList&&a.hotNewsList.length>0&&a.hotNewsList.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.title=$utils.unescape(a.title),a.source=a.src,a.album_pic?(a.imgurl=a.album_pic.split("|")[0],a.width=110,a.height=62,a.img=$utils.dmfd(a.imgurl,a.width,a.height,!0)):a.img=a.imgurl}),a},"",$("#sx-hot"))},k.renderAlbumIfo=function(a,b){return a.album?(window.albumData=a.album,d.call(this,"#album-tmpl",a,b,function(a){var b={};return b=a.album},"",$("#sx-album"))):void 0},k.renderTopics=function(a,b){return a.topic?d.call(this,"#topics-tmpl",a,b,function(a){var b={};return b.topic=a.topic,b},"",$("#sx-topics")):void 0},k.renderRssArtices=function(b,c){window.detListData=b,a.$debug===!0&&console.log("$ContentRender.renderRssArtices("+JSON.stringify(b)+");");var e=$(".wrapper"),f=e.width()-2*$pageHPadding;return d.call(this,"#rss-articles-tmpl",b,c,function(a){return a.media&&a.media.news&&a.media.news.length>0&&(window.detListData.media=a.media,a.rssBtnData=JSON.stringify({id:a.media.id,icon:a.media.icon,name:a.media.name,summary:a.media.summary}),a.media.news=a.media.news.splice(0,2),a.media.news.length<2?a.media.news={}:a.media.news.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.title=$utils.unescape(a.title),a.album_pic&&(a.imgurl=a.album_pic.split("|")[0],a.width=Math.floor((f-15)/2),a.height=100,a.img=$utils.dmfd(a.imgurl,a.width,a.height,!0))}),$("#sx-rss").show()),a},"",$("#sx-rss"))},k.renderComments=function(b,c,e){return a.$debug===!0&&console.log("$ContentRender.renderComments("+JSON.stringify(b)+");"),console.log(b),d.call(this,"#comments-tmpl",b,c,function(a){var b;return a.comments&&a.comments.length>0?(b="最新评论",a._comments=a.comments,a.total>3&&(a.more="查看更多评论")):(b="最新评论",a._comments=[]),!a.title&&b&&(a.title=b),a._comments&&a._comments.length>3&&(a._comments.length=3,a._comments=a._comments.splice(0,3)),a._comments.forEach(function(a){var b=JSON.parse(a.user_info);a.text=decodeURIComponent(a.message),a.username=decodeURIComponent(b.nick_name||b.user_name),a.liked=a.likes||0,a.cid=a.id,a.time=$utils.elapse(a.pdate),a.avatarUrl=decodeURIComponent(b.img_url)||null}),a},e,$("#sx-comments"))},k.refreshComments=function(a){for(var b,c=k.renderComments(a,!1,!0),d=0,e=l.length;e>d;++d)b=$(l[d]),b.attr("class").indexOf("comments")>=0&&b.replaceWith(c)},k.prependComment=function(a){var b,c,d,e={comments:[a]},f=$(".comments.part");f.find(".no-comments").hide(),b=f.find(".comment-list").show(),c=this.renderComments(e,!1,!0),d=$(c).find("li"),b.prepend(d);var g=f.find(".comment-list li").length;g>=3&&f.find(".more-comments").css("display","block"),g>3&&f.find(".comment-list li:last").remove()};var q={time_line:"Timeline"};k.renderExtend=function(b){if(a.$debug===!0&&console.log("$ContentRender.renderExtend("+JSON.stringify(b)+");"),b&&b.data&&(b.data.mood1&&$(".wrapper").trigger("onRenderExtend",[b.data.mood1]),b.data.extend))for(var c,d,e,f=b.data.extend,g=b.data.extend.detailorder.split(","),h=0,i=g.length;i>h;++h)c=g[h],methodName="render"+q[c],d=k[methodName],d?(e=f[c],e?d.call(k,e):console.log("//"+c+" data is missing!")):console.log("//Can not render "+c+", check your spelling")},k.renderCommentsCompose=$.noop,k.done=function(){a.$debug===!0&&console.log("$ContentRender.done();");var b=$(".wrapper");!window.$wap&&j()&&b.trigger("domDone"),b.trigger("done"),b.data("done",!0),console.log("//渲染完成,总耗时"+o+"ms!")},function(b){function c(b,d){var e=new Image,f=b.getAttribute("data-src");e.onload=function(){var a=$(b);a.removeClass("lazy error loading"),a.hasClass("_native-call")&&(a.addClass("native-call"),a.removeClass("_native-call")),b.parent?b.parent.replaceChild(e,b):(b.src=f,$(b).removeClass("lazy")),j()&&!$wap&&$nativeApi.news.articleImgLoaded(b.src),d&&d()},e.onerror=function(){var a=$(b);a.hasClass("native-call")&&a.addClass("_native-call"),a.addClass("error lazy").removeClass("native-call loading").off("tap").tap(function(){a.addClass("loading"),c(b,d)})},a.$debug&&console.log("//加载"+f),e.src=f}function d(a,b){var c=a.ele.getBoundingClientRect(),d=m.height(),e=m.scrollTop(),f=c.top+e,g=f+c.height;return e>=f?g>=e-d:e+3*d>=f}function e(b){var c=0,d=b.length,e=[];for(a.$debug&&console.log("//懒加载"+d+"张图"),c;d>c;++c)e.push({ele:b[c],rect:b[c].getBoundingClientRect()});return e}function f(a,b){return d(a[b],b)?(c(a[b].ele,function(){a[b]=null}),!0):!1}function g(){var b=new Date;if(null==i&&(i=e($("img.lazy")),a.$debug&&(a.$images=i)),0===i.length)return void(l||(i=null));n=b;for(var c=0,d=0;d<i.length;d++)null!=i[d]?f(i,d):c++;c==i.length&&(i.length=0,l=!0)}var h=function(a,c){b.addEventListener?this.addEventListener(a,c,!1):b.attachEvent?this.attachEvent("on"+a,c):this["on"+a]=c},i=null,l=!1,n=null;h("scroll",g),k.lazyLoadImage=function(){a.$debug===!0&&console.log("$ContentRender.lazyLoadImage();"),g()},g()}(this);var r={small:"small",normal:"normal",big:"big",extraBig:"extra-big"};a.adjustFontSize=function(a){var c=r[a]||"normal";$(".wrapper").attr("class","wrapper").addClass(c),b()},a.$ContentRender=k}(this);